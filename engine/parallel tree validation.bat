@echo off
echo "Avvio del ciclo di validazione"



echo "Validazione merged M1"
for /l %%i in (101,5,146) do (
    start "" python graph_engine.py parallel_validation cyberrange_merged ./../../ %%i 5 1 False True True False True
)
TIMEOUT /T 10


echo "in attesa della fine della validazione M1"
TIMEOUT 5 > NUL
:LOOP1
TASKLIST /nh /fi "ImageName eq python.exe" /fo csv 2>NUL | find /C /I "python.exe" | find /I "1" >NUL
IF ERRORLEVEL 1 (
  IF ERRORLEVEL 0 (
    TASKLIST /nh /fi "ImageName eq code.exe" /fo csv 2>NUL | find /C /I "code.exe">NUL
    IF ERRORLEVEL 1 (
      GOTO CONTINUE1
    ) ELSE (
      TIMEOUT /T 200
      GOTO LOOP1
    )
  ) ELSE (
    GOTO CONTINUE1
  )
) ELSE (
  TIMEOUT /T 200
  GOTO LOOP1
)
:CONTINUE1


echo "Validazione merged M2"
for /l %%i in (101,5,146) do (
    start "" python graph_engine.py parallel_validation cyberrange_merged ./../../ %%i 5 2 False True True False True
)
TIMEOUT /T 10


echo "in attesa della fine della validazione M2"
TIMEOUT 5 > NUL
:LOOP2
TASKLIST /nh /fi "ImageName eq python.exe" /fo csv 2>NUL | find /C /I "python.exe" | find /I "1" >NUL
IF ERRORLEVEL 1 (
  IF ERRORLEVEL 0 (
    TASKLIST /nh /fi "ImageName eq code.exe" /fo csv 2>NUL | find /C /I "code.exe">NUL
    IF ERRORLEVEL 1 (
      GOTO CONTINUE2
    ) ELSE (
      TIMEOUT /T 200
      GOTO LOOP2
    )
  ) ELSE (
    GOTO CONTINUE2
  )
) ELSE (
  TIMEOUT /T 200
  GOTO LOOP2
)
:CONTINUE2


echo "Validazione merged M3"
for /l %%i in (101,5,146) do (
    start "" python graph_engine.py parallel_validation cyberrange_merged ./../../ %%i 5 3 False True True False True
)
TIMEOUT /T 10


echo "in attesa della fine della validazione M3"
TIMEOUT 5 > NUL
:LOOP3
TASKLIST /nh /fi "ImageName eq python.exe" /fo csv 2>NUL | find /C /I "python.exe" | find /I "1" >NUL
IF ERRORLEVEL 1 (
  IF ERRORLEVEL 0 (
    TASKLIST /nh /fi "ImageName eq code.exe" /fo csv 2>NUL | find /C /I "code.exe">NUL
    IF ERRORLEVEL 1 (
      GOTO CONTINUE3
    ) ELSE (
      TIMEOUT /T 200
      GOTO LOOP3
    )
  ) ELSE (
    GOTO CONTINUE3
  )
) ELSE (
  TIMEOUT /T 200
  GOTO LOOP3
)
:CONTINUE3


echo "Validazione merged M4"
for /l %%i in (101,5,146) do (
    start "" python graph_engine.py parallel_validation cyberrange_merged ./../../ %%i 5 4 False True True False True
)
TIMEOUT /T 10


echo "in attesa della fine della validazione 31-40"
TIMEOUT 5 > NUL
:LOOP4
TASKLIST /nh /fi "ImageName eq python.exe" /fo csv 2>NUL | find /C /I "python.exe" | find /I "1" >NUL
IF ERRORLEVEL 1 (
  IF ERRORLEVEL 0 (
    TASKLIST /nh /fi "ImageName eq code.exe" /fo csv 2>NUL | find /C /I "code.exe">NUL
    IF ERRORLEVEL 1 (
      GOTO CONTINUE4
    ) ELSE (
      TIMEOUT /T 200
      GOTO LOOP4
    )
  ) ELSE (
    GOTO CONTINUE4
  )
) ELSE (
  TIMEOUT /T 200
  GOTO LOOP4
)
:CONTINUE4


echo "Validazione merged M5"
for /l %%i in (101,5,146) do (
    start "" python graph_engine.py parallel_validation cyberrange_merged ./../../ %%i 5 5 False True True False True
)
TIMEOUT /T 10

:END